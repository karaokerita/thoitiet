<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D·ª± b√°o th·ªùi ti·∫øt</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body {
    font-family: Arial, sans-serif;
    background: url('background.jpg') no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    color: #333;
  }
  h1 {
    text-align: center;
    padding: 10px;
    background: rgba(255, 255, 255, 0.7);
    margin: 0;
  }
  .locations {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    padding: 10px;
  }
  .location {
    flex: 1 1 300px;
    background: rgba(255, 255, 255, 0.85);
    border-radius: 15px;
    padding: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }
  .location:nth-child(1) { background-color: rgba(255, 228, 196, 0.85); }
  .location:nth-child(2) { background-color: rgba(173, 216, 230, 0.85); }
  .location:nth-child(3) { background-color: rgba(152, 251, 152, 0.85); }
  .location h2 {
    margin: 0;
    font-size: 20px;
    text-align: center;
  }
  .datetime {
    text-align: center;
    font-size: 14px;
    margin-bottom: 5px;
    color: #555;
  }
  .forecast {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 5px;
  }
  .day {
    flex: 1 1 100px;
    background: rgba(255,255,255,0.9);
    border-radius: 10px;
    padding: 5px;
    text-align: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
  .temp-high { color: red; font-weight: bold; }
  .temp-low { color: blue; }
  .controls {
    text-align: center;
    margin: 10px;
  }
  #map {
    height: 400px;
    margin-top: 20px;
  }
  @media (max-width: 600px) {
    .forecast { flex-direction: column; align-items: center; }
    .day { width: 80%; }
  }
</style>
</head>
<body>

<h1>D·ª± b√°o th·ªùi ti·∫øt</h1>

<div class="controls">
  <label for="datePicker">Ch·ªçn ng√†y: </label>
  <input type="date" id="datePicker">
</div>

<div class="locations">
  <div class="location" id="location1">
    <h2>ƒê·ª©c Tr·ªçng ‚Äì L√¢m ƒê·ªìng</h2>
    <div class="datetime" id="time1"></div>
    <div class="forecast" id="forecast1"></div>
  </div>
  <div class="location" id="location2">
    <h2>T√¢n An ‚Äì Long An</h2>
    <div class="datetime" id="time2"></div>
    <div class="forecast" id="forecast2"></div>
  </div>
  <div class="location" id="location3">
    <h2>TP. H·ªì Ch√≠ Minh</h2>
    <div class="datetime" id="time3"></div>
    <div class="forecast" id="forecast3"></div>
  </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const locations = [
  { name: "ƒê·ª©c Tr·ªçng ‚Äì L√¢m ƒê·ªìng", lat: 11.745, lon: 108.353, timeId: "time1", forecastId: "forecast1" },
  { name: "T√¢n An ‚Äì Long An", lat: 10.535, lon: 106.413, timeId: "time2", forecastId: "forecast2" },
  { name: "TP. H·ªì Ch√≠ Minh", lat: 10.776, lon: 106.700, timeId: "time3", forecastId: "forecast3" }
];

function updateTime() {
  const now = new Date();
  locations.forEach(loc => {
    document.getElementById(loc.timeId).textContent = now.toLocaleString('vi-VN');
  });
}
setInterval(updateTime, 1000);
updateTime();

async function getForecast(lat, lon, containerId, selectedDate = null) {
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`;
  const res = await fetch(url);
  const data = await res.json();

  let { time, temperature_2m_max, temperature_2m_min, precipitation_probability_max } = data.daily;

  if (selectedDate) {
    const idx = time.indexOf(selectedDate);
    if (idx !== -1) {
      let start = Math.max(0, idx - 3);
      let end = Math.min(time.length, idx + 4);
      time = time.slice(start, end);
      temperature_2m_max = temperature_2m_max.slice(start, end);
      temperature_2m_min = temperature_2m_min.slice(start, end);
      precipitation_probability_max = precipitation_probability_max.slice(start, end);
    }
  }

  const container = document.getElementById(containerId);
  container.innerHTML = "";
  time.forEach((date, i) => {
    const dayName = new Date(date).toLocaleDateString('vi-VN', { weekday: 'short' });
    container.innerHTML += `
      <div class="day">
        <div><strong>${dayName}</strong></div>
        <div>${date}</div>
        <div class="temp-high">${temperature_2m_max[i]}¬∞C</div>
        <div class="temp-low">${temperature_2m_min[i]}¬∞C</div>
        <div>üåß ${precipitation_probability_max[i]}%</div>
      </div>
    `;
  });
}

function loadAll(selectedDate = null) {
  locations.forEach(loc => {
    getForecast(loc.lat, loc.lon, loc.forecastId, selectedDate);
  });
}

document.getElementById("datePicker").addEventListener("change", e => {
  loadAll(e.target.value);
});

loadAll();

// B·∫£n ƒë·ªì
const map = L.map('map').setView([12.0, 108.0], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

locations.forEach(loc => {
  L.marker([loc.lat, loc.lon]).addTo(map)
    .bindPopup(`<b>${loc.name}</b>`);
});

map.on('click', async function(e) {
  const lat = e.latlng.lat.toFixed(3);
  const lon = e.latlng.lng.toFixed(3);
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`;
  const res = await fetch(url);
  const data = await res.json();
  let content = `<b>V·ªã tr√≠: ${lat}, ${lon}</b><br><br>`;
  data.daily.time.forEach((date, i) => {
    const dayName = new Date(date).toLocaleDateString('vi-VN', { weekday: 'short' });
    content += `${dayName} ${date}: <span style="color:red">${data.daily.temperature_2m_max[i]}¬∞C</span> / <span style="color:blue">${data.daily.temperature_2m_min[i]}¬∞C</span> üåß ${data.daily.precipitation_probability_max[i]}%<br>`;
  });
  L.popup()
    .setLatLng(e.latlng)
    .setContent(content)
    .openOn(map);
});
</script>
</body>
</html>
