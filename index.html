<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Th·ªùi ti·∫øt h√¥m nay</title>
  <style>
    body { font-family: system-ui, sans-serif; background: #0b1220; color: #eaf0ff; margin: 0; padding: 0; }
    header { padding: 20px; background: #121a2a; text-align:center; }
    h1 { margin:0; }
    main { padding: 20px; display: grid; gap: 32px; }
    .location-block { background: #121a2a; padding: 16px; border-radius: 6px; }
    .loc-title { font-size: 20px; font-weight: bold; margin-bottom: 12px; color: #5fb3ff; }
    .current { display: flex; flex-wrap: wrap; align-items: center; gap: 16px; }
    .temp { font-size: 40px; font-weight: bold; }
    .emoji { font-size: 40px; }
    .meta { font-size: 14px; color: #9db0d3; }
    .daily { display: grid; grid-template-columns: repeat(auto-fill,minmax(110px,1fr)); gap: 12px; margin-top: 12px; }
    .day { background: #1a2743; padding: 8px; border-radius: 6px; text-align: center; font-size: 12px; }
    .day .t { font-size: 16px; font-weight: bold; }
    select { padding: 6px; border-radius: 6px; margin-bottom: 8px; }
  </style>
</head>
<body>
  <header>
    <h1>üå§Ô∏è Th·ªùi ti·∫øt nhanh</h1>
    <div>
      <label>Hi·ªÉn th·ªã d·ª± b√°o:</label>
      <select id="daysSelect">
        <option value="7">7 ng√†y</option>
        <option value="14">14 ng√†y</option>
      </select>
    </div>
  </header>

  <main id="content"></main>

  <footer style="text-align:center; padding: 10px; font-size: 12px; color: #9db0d3">
    D·ªØ li·ªáu: <a href="https://open-meteo.com/" target="_blank" style="color:#a7c9ff">Open-Meteo</a>
  </footer>

<script>
const wmo = {
  0:['Tr·ªùi quang','‚òÄÔ∏è'],1:['G·∫ßn nh∆∞ quang','üå§Ô∏è'],2:['Nhi·ªÅu m√¢y','‚õÖ'],3:['U √°m','‚òÅÔ∏è'],
  45:['S∆∞∆°ng m√π','üå´Ô∏è'],48:['S∆∞∆°ng b√°m','üå´Ô∏è'],
  51:['M∆∞a ph√πn nh·∫π','üå¶Ô∏è'],53:['M∆∞a ph√πn v·ª´a','üå¶Ô∏è'],55:['M∆∞a ph√πn to','üåßÔ∏è'],
  61:['M∆∞a nh·∫π','üå¶Ô∏è'],63:['M∆∞a v·ª´a','üåßÔ∏è'],65:['M∆∞a to','üåßÔ∏è'],
  71:['Tuy·∫øt nh·∫π','üå®Ô∏è'],73:['Tuy·∫øt v·ª´a','üå®Ô∏è'],75:['Tuy·∫øt to','‚ùÑÔ∏è'],
  80:['M∆∞a r√†o nh·∫π','üå¶Ô∏è'],81:['M∆∞a r√†o v·ª´a','üåßÔ∏è'],82:['M∆∞a r√†o l·ªõn','‚õàÔ∏è'],
  95:['D√¥ng','‚õàÔ∏è']
};

const locations = [
  { name: 'ƒê·ª©c Tr·ªçng - L√¢m ƒê·ªìng', query: 'Duc Trong, Lam Dong' },
  { name: 'T√¢n An - Long An', query: 'Tan An, Long An' },
  { name: 'TP. H·ªì Ch√≠ Minh', query: 'Ho Chi Minh' }
];

const content = document.getElementById('content');
const daysSelect = document.getElementById('daysSelect');

function fmtDate(iso){
  const d = new Date(iso);
  return d.toLocaleDateString('vi-VN', { weekday:'short', day:'2-digit', month:'2-digit' });
}

async function geocode(name){
  const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(name)}&count=1&language=vi&format=json`;
  const r = await fetch(url);
  const j = await r.json();
  return j.results && j.results.length ? j.results[0] : null;
}

async function forecast(lat, lon, days){
  const base = 'https://api.open-meteo.com/v1/forecast';
  const params = new URLSearchParams({
    latitude: lat, longitude: lon,
    current: 'temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,precipitation',
    daily: 'weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum',
    forecast_days: days,
    timezone: 'auto'
  });
  const r = await fetch(`${base}?${params}`);
  return await r.json();
}

function renderLocationBlock(label, data){
  const c = data.current;
  const [text, emoji] = wmo[c.weather_code] || ['Kh√¥ng r√µ','üåÄ'];
  const dailyHTML = data.daily.time.map((t, i) => {
    const [dtxt, e] = wmo[data.daily.weather_code[i]] || ['‚Äî','üåÄ'];
    return `<div class="day"><div>${fmtDate(t)}</div><div style="font-size:20px">${e}</div><div class="t">${Math.round(data.daily.temperature_2m_max[i])}¬∞ / ${Math.round(data.daily.temperature_2m_min[i])}¬∞</div><div>${dtxt}</div><div>M∆∞a: ${Math.round(data.daily.precipitation_sum[i]||0)} mm</div></div>`;
  }).join('');

  return `<div class="location-block">
    <div class="loc-title">${label}</div>
    <div class="current">
      <div class="temp">${Math.round(c.temperature_2m)}¬∞C</div>
      <div class="emoji">${emoji}</div>
      <div>${text}</div>
    </div>
    <div class="meta">ƒê·ªô ·∫©m: ${c.relative_humidity_2m}% | Gi√≥: ${Math.round(c.wind_speed_10m)} km/h | M∆∞a: ${c.precipitation || 0} mm</div>
    <div class="daily">${dailyHTML}</div>
  </div>`;
}

async function loadAll(){
  content.innerHTML = 'ƒêang t·∫£i...';
  const days = parseInt(daysSelect.value);
  const blocks = [];
  for(const loc of locations){
    const g = await geocode(loc.query);
    if(!g) continue;
    const data = await forecast(g.latitude, g.longitude, days);
    blocks.push(renderLocationBlock(loc.name, data));
  }
  content.innerHTML = blocks.join('');
}

daysSelect.addEventListener('change', loadAll);

loadAll();
</script>
</body>
</html>
