<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Th·ªùi ti·∫øt ki·ªÉu iOS</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background: url('background.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
  }
  header {
    position: sticky;
    top: 0;
    background: rgba(0,0,0,0.3);
    padding: 10px;
    text-align: center;
    font-weight: bold;
    font-size: 20px;
    backdrop-filter: blur(10px);
    z-index: 1000;
  }
  .locations {
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 10px;
  }
  .location {
    background: rgba(255,255,255,0.3);
    border-radius: 12px;
    padding: 10px;
    backdrop-filter: blur(8px);
  }
  .location h2 {
    margin: 0;
    font-size: 18px;
  }
  .days {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
  }
  .day {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 10px;
    padding: 8px;
    background: rgba(255,255,255,0.2);
  }
  .day.today {
    background: rgba(255,255,255,0.4);
    font-weight: bold;
  }
  .temp-low { color: #00f; }
  .temp-high { color: #f00; }
  .rain { color: #000; display: flex; align-items: center; gap: 4px; }
  .icon { width: 30px; height: 30px; }
  #date-picker {
    margin: 10px auto;
    display: block;
    padding: 5px;
    border-radius: 8px;
    border: none;
  }
  #map {
    height: 300px;
    margin-top: 10px;
  }
</style>
</head>
<body>

<header>
  Th·ªùi ti·∫øt 3 v·ªã tr√≠ c·ªë ƒë·ªãnh<br>
  <small id="current-time"></small>
</header>

<input type="date" id="date-picker">

<div class="locations" id="locations"></div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const fixedLocations = [
  { name: "ƒê·ª©c Tr·ªçng ‚Äì L√¢m ƒê·ªìng", lat: 11.7407, lon: 108.3705, color: "rgba(255,255,255,0.3)" },
  { name: "T√¢n An ‚Äì Long An", lat: 10.5359, lon: 106.4137, color: "rgba(255,255,255,0.25)" },
  { name: "TP. H·ªì Ch√≠ Minh", lat: 10.7769, lon: 106.7009, color: "rgba(255,255,255,0.2)" }
];

function updateClock(){
  document.getElementById('current-time').textContent =
    new Date().toLocaleString('vi-VN');
}
setInterval(updateClock,1000);
updateClock();

function getIcon(condition){
  if(condition.includes("rain")) return "üåßÔ∏è";
  if(condition.includes("cloud")) return "‚òÅÔ∏è";
  return "‚òÄÔ∏è";
}

function getWeatherData(lat, lon){
  // DEMO DATA (random) v√¨ kh√¥ng d√πng API key
  let days = [];
  for(let i=-2;i<=2;i++){
    const date = new Date();
    date.setDate(date.getDate() + i);
    days.push({
      date: date,
      low: Math.floor(Math.random()*5)+20,
      high: Math.floor(Math.random()*5)+30,
      rainChance: Math.floor(Math.random()*80),
      condition: ["sun","cloud","rain"][Math.floor(Math.random()*3)]
    });
  }
  return days;
}

function renderLocations(dateSelected){
  const container = document.getElementById("locations");
  container.innerHTML = "";
  fixedLocations.forEach((loc) => {
    const locDiv = document.createElement("div");
    locDiv.className = "location";
    locDiv.style.background = loc.color;
    locDiv.innerHTML = `<h2>${loc.name}</h2>`;
    const daysDiv = document.createElement("div");
    daysDiv.className = "days";
    const data = getWeatherData(loc.lat, loc.lon);
    data.forEach(d => {
      const dayDiv = document.createElement("div");
      dayDiv.className = "day";
      if(d.date.toDateString() === new Date().toDateString()){
        dayDiv.classList.add("today");
      }
      dayDiv.innerHTML = `
        <span>${d.date.toLocaleDateString('vi-VN', {weekday:'short', day:'2-digit', month:'2-digit'})}</span>
        <img class="icon" src="" alt="${d.condition}">${getIcon(d.condition)}
        <span class="temp-low">${d.low}¬∞</span>
        <span class="temp-high">${d.high}¬∞</span>
        <span class="rain">üíß${d.rainChance}%</span>
      `;
      daysDiv.appendChild(dayDiv);
    });
    locDiv.appendChild(daysDiv);
    container.appendChild(locDiv);
  });
}

renderLocations(new Date());

document.getElementById("date-picker").addEventListener("change", e=>{
  renderLocations(new Date(e.target.value));
});

// Map
const map = L.map('map').setView([11.7407, 108.3705], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

let clickMarker;
map.on('click', async function(e){
  if(clickMarker) map.removeLayer(clickMarker);
  const lat = e.latlng.lat;
  const lon = e.latlng.lng;
  let placeName = "V·ªã tr√≠ ƒë√£ ch·ªçn";
  try {
    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
    const data = await res.json();
    if(data.address){
      const ward = data.address.suburb || data.address.village || data.address.town || "";
      const prov = data.address.state || data.address.city || "";
      placeName = `${ward} ‚Äì ${prov}`;
    }
  } catch{}
  clickMarker = L.marker([lat, lon]).addTo(map).bindPopup(`<b>${placeName}</b><br>${Math.floor(Math.random()*5)+20}¬∞ / ${Math.floor(Math.random()*5)+30}¬∞, üíß${Math.floor(Math.random()*80)}%`).openPopup();
});
</script>
</body>
</html>
