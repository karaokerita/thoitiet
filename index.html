<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dự báo thời tiết</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: url('background.jpg') no-repeat center center fixed;
        background-size: cover;
        color: #fff;
    }
    .overlay {
        background: rgba(0,0,0,0.4);
        padding: 10px;
    }
    h1 {
        text-align: center;
        margin: 10px 0 0;
    }
    #clock {
        text-align: center;
        margin-bottom: 10px;
        font-weight: bold;
    }
    .weather-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }
    .location {
        background: rgba(255,255,255,0.8);
        color: #000;
        border-radius: 10px;
        padding: 10px;
        width: 300px;
        box-sizing: border-box;
    }
    .location h2 {
        text-align: center;
        margin: 0 0 10px;
    }
    .day-card {
        background: rgba(255,255,255,0.9);
        border-radius: 8px;
        padding: 5px;
        margin: 5px 0;
        text-align: center;
    }
    .temp-low {
        color: blue;
    }
    .temp-high {
        color: red;
    }
    #map {
        width: 100%;
        height: 60vh;
        margin-top: 10px;
    }
    .leaflet-popup-content {
        font-size: 14px;
    }
</style>
</head>
<body>
<div class="overlay">
    <h1>Dự báo thời tiết</h1>
    <div id="clock"></div>
    <div class="weather-container" id="weather-container">
        <!-- 3 vị trí cố định -->
    </div>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const locations = [
    {name: "Đức Trọng - Lâm Đồng", lat: 11.735, lon: 108.373},
    {name: "Tân An - Long An", lat: 10.535, lon: 106.413},
    {name: "TP. Hồ Chí Minh", lat: 10.776, lon: 106.700}
];

// Đồng hồ thời gian thực
function updateClock(){
    const now = new Date();
    document.getElementById('clock').innerText = 
        now.toLocaleString('vi-VN', {weekday:'long', year:'numeric', month:'long', day:'numeric', hour:'2-digit', minute:'2-digit', second:'2-digit'});
}
setInterval(updateClock, 1000);
updateClock();

// Lấy thời tiết cho vị trí
async function getWeather(lat, lon) {
    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=auto`);
    return res.json();
}

// Hiển thị thời tiết 3 vị trí cố định
async function loadWeather(){
    const container = document.getElementById('weather-container');
    container.innerHTML = '';
    for (let loc of locations){
        const data = await getWeather(loc.lat, loc.lon);
        const div = document.createElement('div');
        div.className = 'location';
        div.innerHTML = `<h2>${loc.name}</h2>`;
        for (let i=0; i<7; i++){
            const date = new Date(data.daily.time[i]);
            div.innerHTML += `
                <div class="day-card">
                    <strong>${date.toLocaleDateString('vi-VN', {weekday:'short', day:'numeric', month:'numeric'})}</strong><br>
                    <span class="temp-low">${data.daily.temperature_2m_min[i]}°C</span> - 
                    <span class="temp-high">${data.daily.temperature_2m_max[i]}°C</span><br>
                    ☔ ${data.daily.precipitation_probability_max[i]}%
                </div>`;
        }
        container.appendChild(div);
    }
}
loadWeather();

// Bản đồ Leaflet
const map = L.map('map').setView([11.735, 108.373], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
}).addTo(map);

// Marker 3 vị trí cố định
locations.forEach(loc => {
    L.marker([loc.lat, loc.lon]).addTo(map).bindPopup(`<b>${loc.name}</b>`);
});

// Xử lý click/chạm trên bản đồ
function onMapClick(e){
    const lat = e.latlng.lat;
    const lon = e.latlng.lng;
    fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
    .then(res => res.json())
    .then(info => {
        const name = info.address?.state || info.address?.province || info.address?.county || "Không xác định";
        L.popup()
         .setLatLng(e.latlng)
         .setContent(`<b>${name}</b><br>Lat: ${lat.toFixed(3)}, Lon: ${lon.toFixed(3)}`)
         .openOn(map);
    });
}
map.on('click', onMapClick);
map.on('touchend', function(e){
    if (e.latlng) onMapClick(e);
});
</script>
</body>
</html>
